import argparse
import serial
import time
import os
parser = argparse.ArgumentParser(description='Planet command')


#parser.add_argument('-u', '--up', dest='pull_up', default=False, action="store_true")
#parser.add_argument('-d', '--doww', dest='pull_down', default=False, action="store_true")
#args = parser.parse_args()
login_in = False

ser = serial.Serial('/dev/ttyUSB0', 115200)#, timeout=1)
time.sleep(1)
try:
    while 1:
        #pass
        #ser.write(b'+')
        #print(ser.readline())
        try:
            line_read = str(ser.readline().rstrip(),"utf-8")
        except:
            pass
        print(line_read)
        #ser.write(b'')
        if ("login" in line_read ):
            print ("root")
            ser.write(b'root\n')
        elif ( "Password" in line_read ):
            print ("a")
            ser.write(b'a\n')
            login_in = True

        elif ( "Sending select for" in line_read ):
            print(line_read.split("Sending select for"))
            update_ip()

        if login_in:
            ser.write(b'reboot\n')
            login_in = False

        #print(line_read)

except KeyboardInterrupt:
    pass
finally:
    ser.close()


def update_ip(ip):
    print(ip)
    #f = open(os.path.abspath("~/.ipPortia.txt",'w'))
    #f.wriote 
